# sql 실행계획
- 실행 계획이란?
  - 옵티마이저가 SQL문을 어떤 방식으로 어떻게 처리할 지를 계획한 걸 의미
  - 이 실행 계획을 보고 비효율적으로 처리하는 방식이 있는 지 점검하고, 비효율적인 부분이 있다면 더 효율적인 방법으로 SQL문을 실행하게끔 튜닝
```
# 실행 계획 조회하기
EXPLAIN [SQL문]

# 실행 계획에 대한 자세한 정보 조회하기
EXPLAIN ANALYZE [SQL문]
```

### EXPLAIN

![image](https://github.com/user-attachments/assets/4f268b8e-6554-48b6-be00-3a067538b157)

**실행 계획 주요 값들**
</br>
- `id` : 실행 순서
- `table` : 조회한 테이블 명
- **`type` : 테이블의 데이터를 어떤 방식으로 조회하는 지**
- **`possible keys` : 사용할 수 있는 인덱스 목록을 출력**
- **`key` : 데이터 조회할 때 실제로 사용한 인덱스 값**
- `ref` : 테이블 조인 상황에서 어떤 값을 기준으로 데이터를 조회했는 지
- **`rows` : SQL문 수행을 위해 접근하는 데이터의 모든 행의 수 (= 데이터 액세스 수)**
    
    **→ 이 값을 줄이는 게 SQL 튜닝의 핵심이다!**
    
- `filtered` : 필터 조건에 따라 어느 정도의 비율로 데이터를 제거했는 지 의미
    
    → filtered의 값이 30이라면 100개의 데이터를 불러온 뒤 30개의 데이터만 실제로 응답하는데 사용했음을 의미한다. 
    
    → filtered 비율이 낮을 수록 쓸데없는 데이터를 많이 불러온 것.
    
- **`Extra` : 부가적인 정보를 제공**
    
    → ex. `Using where`, `Using index`
- 주의) `rows`, `filtered`의 값은 정확한 수치가 아닌 추정값이기 때문에 오차가 있을 수 있다.

### EXPLAIN ANALYZE

![image](https://github.com/user-attachments/assets/acab91c3-3135-4d9c-a9a3-fcd066ff07f7)

- 밑에서 부터 위로 읽어가면 된다
- (actual time ~ )부분이 중요
- `Table scan on users` : users 테이블을 풀 스캔했다.
    - `rows` : 접근한 데이터의 행의 수
    - `actual time=0.0302..0.0339`
        - `0.0302` (앞에 있는 숫자) : 첫 번째 데이터에 접근하기까지의 시간
        - `0.0339` (뒤에 있는 숫자) : 마지막 데이터까지 접근한 시간
        - 뒤의 숫자를 보고 걸린 시간을 파악하면 된다. 테이블 스캔에 0.0339ms의 시간이 걸렸다.
        - Filter 에 걸린 시간은 0.037 - 0.0339로 계산 가능
- `Filter: (users.age = 23)` : 필터링을 통해 데이터를 추출했다. 필터링을 할 때의 조건은 `users.age = 23`이다.


### 실행 계획 type
- ALL : 풀 테이블 스캔
  - 풀 테이블 스캔(Full Table Scan)이란 인덱스를 활용하지 않고 테이블을 처음부터 끝까지 전부 다 뒤져서 데이터를 찾는 방식.
  - 처음부터 끝까지 전부 다 뒤져서 필요한 데이터를 찾는 방식이다보니 비효율.
- index : 풀 인덱스 스캔
  - 인덱스 테이블을 처음부터 끝까지 다 뒤져서 데이터를 찾는 방식.
  - 인덱스의 테이블은 실제 테이블보다 크기가 작기 때문에, 풀 테이블 스캔(Full Table Scan)보다 효율적.
  - 하지만 인덱스 테이블 전체를 읽어야 하기 때문에 아주 효율적이라고 볼 수는 없다.
- const : 1건의 데이터를 바로 찾을 수 있는 경우
  -  조회하고자 하는 1건의 데이터를 헤매지 않고 단번에 찾아올 수 있을 때 `const`가 출력
  -  그러다보니 **고유 인덱스** 또는 **기본 키**를 사용해서 1건의 데이터만 조회한 경우에 `const`가 출력
  -  이 방식은 아주 효율적인 방식.
- range : 인덱스 레인지 스캔
  - 인덱스 레인지 스캔(Index Range Scan)은 인덱스를 활용해 범위 형태의 데이터를 조회한 경우를 의미
    - 범위 형태란 BETWEEN, 부등호(<, >, ≤, ≥), IN, LIKE를 활용한 데이터 조회를 뜻한다
  - 이 방식은 인덱스를 활용하기 때문에 효율적인 방식이다.
  - 하지만 인덱스를 사용하더라도 데이터를 조회하는 범위가 클 경우 성능 저하의 원인이 되기도 한다.
- ref : 비고유 인덱스를 활용하는 경우
  - 비고유 인덱스를 사용한 경우 (= UNIQUE가 아닌 컬럼의 인덱스를 사용한 경우) type에 ref가 출력된다. 
